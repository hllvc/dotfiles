# add prefix mapping to C-f leaving C-b enabled
set -g prefix C-f
bind C-f send-prefix
set -g status-style 'bg=#1C1C1C fg=#5eacd3'

set -g window-active-style 'fg=terminal,bg=terminal'
set -g window-style 'fg=colour240,bg=#1a1a1a'

set focus-events on
# set-hook -g client-focus-in "set window-active-style 'fg=terminal,bg=terminal'"
# set-hook -g client-focus-out "set window-active-style 'fg=terminal,bg=black'"

### VISUAL CONFIG

# loud or quiet?
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

set -s exit-empty off
set -s escape-time 0
# set -g default-terminal "xterm-256color"
set -g history-limit 50000

setw -g mode-keys vi
bind P paste-buffer
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

bind r source-file ~/.tmux.conf

bind M switch-client -t'{marked}'
bind L switch-client -l

bind o neww -n ssh "~/.shell/scripts/ss.sh"
bind O popup -E -w80% -h80% 'nvim ~/.ssh/config'

bind T popup -E -w80% -h80% 'nvim ~/.tmux.conf'
bind Z popup -E -w80% -h80% 'nvim ~/.zshrc'
# bind O popup -E -w80% -h80% 'fzf #{pane_current_path} | xargs nvim -'

bind G popup -E -w80% -h80% 'gotop'
# bind G run-shell "tmux neww -n gotop 'gotop'"
bind C-t popup -E -w80% -h80% 'zsh'
bind N popup -E -w80% -h80% '~/.shell/scripts/tmux/new-session.sh'
bind W popup -E -w80% -h80% '~/.shell/scripts/tmux/move-window.sh'

# split panes using v and s
# unbind C-v
# unbind C-s
bind C-v split-window -h -c "#{pane_current_path}"
bind C-s split-window -v -c "#{pane_current_path}"
unbind '"'
# unbind %
# bind -n C-x kill-pane

# # Use Shift+arrow to switch windows
# bind "H" previous-window
# bind "L" next-window

# # resizing with shift
# bind -r J resize-pane -D 5
# bind -r K resize-pane -U 5
# bind -r H resize-pane -L 5
# bind -r L resize-pane -R 5
# # resize with alt
# bind -r C-j resize-pane -D
# bind -r C-k resize-pane -U
# bind -r C-h resize-pane -L
# bind -r C-l resize-pane -R

# Enable mouse control (clickable windows, panes, resizable panes)
setw -g mouse on

# don't rename windows automatically
set -g allow-rename off
setw -g automatic-rename off
# set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
setw -g aggressive-resize on

# Extended keys (tmux 3.5+)
set -g extended-keys on
set -g extended-keys-format csi-u

# Scrollbars (tmux 3.6+)
# set -g pane-scrollbars modal
# set -g pane-scrollbars-position right

# Copy mode styling (tmux 3.6+)
set -g copy-mode-position-style 'fg=black,bg=yellow'
set -g copy-mode-selection-style 'fg=black,bg=cyan'

bind Q kill-server

set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-ghostty:Tc"
set -ga terminal-features ",xterm-ghostty:256:RGB:mouse:ccolour:cstyle:focus:title:usstyle"

# Theme

# Status Bar
set -g status-style fg=brightblack
set -g status-position bottom

# set -g status-left " # #(basename #{socket_path} | tr '[:lower:]' '[:upper:]')"
# set -g status-left " #[bold]#[fg=white]# #[nobold]#[fg=white]#(basename #{socket_path})  "
# set -g status-left-style fg=brightblack,bg=default
set -g status-left ""
# set -g status-left-length 40

# set -g status-right-style bg=default
# set -g status-right-length 40
set -g status-right "  #[bold]#[fg=white]# #[nobold]#{?#{==:#{@mode_indicator_custom_prompt},},#{?pane_in_mode,#[default]#[bold]#[fg=red],#{?client_prefix,#[fg=blue]#[bold],#[fg=white]}}#(basename #{socket_path}),#[fg=black]#(basename #{socket_path} | tr '[:alpha:]' '-')}"

# Window status
set -g window-status-separator " "
set -g status-justify centre

# set -g window-status-format "#I:#W"
set -g window-status-format "#{?#{==:#{window_marked_flag},1},#[fg=white]#I:#[fg=blue],#I:}#{?#{==:#{window_zoomed_flag},1},#[underscore],}#W"
# set -g window-status-format "#{?#{==:#{window_last_flag},1},-,#I}:#W"
# set -g window-status-format "#{?#{==:#{window_last_flag},1},#[fg=red]#I#[default],#I}:#W"
# set -g window-status-current-format "#[default]-:#[bold]#W"
set -g window-status-current-format "#I:#{?#{==:#{window_zoomed_flag},1},#[underscore],}#[bold]#W"

# set -g window-status-style fg=brightblack
set -g window-status-current-style fg=white
set -g window-status-last-style fg=white

# Window with activity status
set -g window-status-activity-style fg=brightblack,bg=yellow

# Pane border

set -g pane-border-lines single
set -g pane-border-indicators arrows

set -g pane-border-style fg=brightblack
set -g pane-active-border-style fg=brightblack

# Pane number indicator
# set -g display-panes-colour red
# set -g display-panes-active-colour magenta

# Message
set -g message-style fg=white,bg=default

# Command message
set -g message-command-style fg=yellow,bg=default

## VIM pane switching
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind -n 'M-h' if-shell "$is_vim" 'send M-h'  'select-pane -L'
bind -n 'M-j' if-shell "$is_vim" 'send M-j'  'select-pane -D'
bind -n 'M-k' if-shell "$is_vim" 'send M-k'  'select-pane -U'
bind -n 'M-l' if-shell "$is_vim" 'send M-l'  'select-pane -R'
bind -n 'M-\' if-shell "$is_vim" 'send M-\\'  'select-pane -l'

### PLUGINS

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

# set -g @plugin 'MunifTanjim/tmux-mode-indicator'
set -g @plugin 'MunifTanjim/tmux-suspend'
set -g @suspend_key 'F2'

# extrakto
set -g @plugin 'laktak/extrakto'
set -g @extrakto_key 'a'
set -g @extrakto_grab_area 'window recent'
set -g @extrakto_popup_size '80%'
set -g @extrakto_copy_key 'space'
set -g @extrakto_insert_key 'enter'

set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-bind 'u'

# resurrect+continuum
set -g @plugin 'hllvc/tmux-resurrect'
set -g @resurrect-save 'S'
set -g @plugin 'hllvc/tmux-continuum'
set -g @continuum-save-interval '5'
set -g @continuum-multiple-sockets 'on'
set -g @continuum-restore 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
